# Guide 404 & 410 - Configuration Production

## Installation & Usage

### Pour Next.js 14 App Router

1. **Fichiers à placer :**
   - `app/not-found.tsx` → Page 404 personnalisée
   - `lib/gone-paths.ts` → Liste des URLs 410
   - `middleware.ts` → Gestion 410 et noindex previews
   - `next.config.ts` → Headers additionnels

2. **Ajouter une URL 410 :**
   ```typescript
   // Dans lib/gone-paths.ts
   export const gonePaths = new Set<string>([
     '/ancienne-page',  // Ajouter ici
   ]);
   ```

3. **Test local :**
   ```bash
   npm run dev
   # ou
   vercel dev
   ```

### Pour Site Statique

1. **Fichiers à placer :**
   - `public/404.html` → Page 404 statique
   - `api/gone.ts` → Edge function pour 410
   - `config/gone-paths.json` → Liste des URLs 410
   - `vercel.json` → Configuration rewrites

2. **Ajouter une URL 410 :**
   - Éditer `config/gone-paths.json`
   - Ajouter le rewrite correspondant dans `vercel.json`

## Commandes de Test

### Test 404 (page inexistante)
```bash
# Local
curl -I http://localhost:3000/page-inexistante

# Production
curl -I https://yathra.fr/page-inexistante

# Résultat attendu :
HTTP/1.1 404 Not Found
Content-Type: text/html
# Pas de X-Robots-Tag (le status 404 suffit)
```

### Test 410 (contenu supprimé)
```bash
# Local
curl -I http://localhost:3000/services/webdesign-flash

# Production  
curl -I https://yathra.fr/services/webdesign-flash

# Résultat attendu :
HTTP/1.1 410 Gone
Content-Type: text/html; charset=utf-8
X-Robots-Tag: noindex, nofollow
Cache-Control: public, max-age=31536000
```

### Test Noindex Previews
```bash
# Preview Vercel
curl -I https://your-app-git-branch.vercel.app/

# Résultat attendu :
HTTP/1.1 200 OK
X-Robots-Tag: noindex, nofollow, noarchive, nosnippet
```

### Test avec navigateur
```bash
# Vérifier le rendu HTML de la 404
curl http://localhost:3000/page-inexistante

# Vérifier que les assets (CSS/JS) sont bien chargés sur la 404
curl -I http://localhost:3000/_next/static/css/[hash].css
# Doit retourner 200 OK (pas bloqué)
```

## Checklist SEO

### ✅ Pour les 404
- [x] Retourne bien le statut HTTP 404
- [x] Page HTML utile avec navigation
- [x] Liens vers pages principales
- [x] Pas de `noindex` dans le HTML (le 404 suffit)
- [x] Assets CSS/JS accessibles

### ✅ Pour les 410
- [x] Retourne bien le statut HTTP 410
- [x] Header `X-Robots-Tag: noindex, nofollow`
- [x] Cache long terme (1 an)
- [x] Message clair "supprimé définitivement"
- [x] URLs retirées du sitemap

### ✅ Pour les Previews
- [x] Header `X-Robots-Tag: noindex` sur *.vercel.app
- [x] Pas d'impact sur le domaine principal

## Pièges à éviter

### ❌ NE PAS FAIRE
- Retourner 200 avec page "not found" → Soft 404, mauvais pour SEO
- Mettre toutes les redirections en 410 → Réserver aux suppressions définitives
- Bloquer les assets sur 404 → La page doit rester navigable
- Catch-all redirect vers homepage → Masque les vraies 404

### ✅ BONNES PRATIQUES
- 404 = temporaire ou page jamais existé
- 410 = suppression définitive confirmée
- Toujours retirer du sitemap les URLs 410
- Logger les 404 pour détecter les liens cassés
- Monitorer avec Google Search Console

## Déploiement sur Vercel

```bash
# 1. Commit des changements
git add .
git commit -m "feat: add 404/410 handling with SEO optimization"

# 2. Push vers GitHub
git push origin main

# 3. Vercel déploie automatiquement

# 4. Vérifier après déploiement
curl -I https://yathra.fr/une-page-qui-nexiste-pas  # → 404
curl -I https://yathra.fr/services/webdesign-flash  # → 410
```

## Monitoring

### Google Search Console
- Vérifier l'onglet "Couverture" → "Exclues"
- Les 404 doivent apparaître comme "Introuvable (404)"
- Les 410 doivent disparaître après quelques crawls

### Analytics
- Créer une vue filtrée pour les 404
- Tracker les 410 comme events
- Alertes si trop de 404 sur pages importantes

## Support

Pour toute question :
- Documentation Vercel : https://vercel.com/docs
- Next.js Error Pages : https://nextjs.org/docs/app/api-reference/file-conventions/not-found
- Google 404/410 : https://developers.google.com/search/docs/crawling-indexing/http-network-errors